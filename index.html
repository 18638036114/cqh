<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>心理健康自评测试</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", sans-serif;
        }

        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            padding: 12px;
            min-height: 100vh;
            -webkit-text-size-adjust: 100%;
        }

        .container {
            background: white;
            border-radius: 18px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            overflow: hidden;
        }

        .header {
            background: #4b6cb7;
            color: white;
            padding: 20px 18px 16px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 6px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
            line-height: 1.4;
        }

        .restart-btn {
            position: absolute;
            top: 16px;
            right: 16px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            border-radius: 16px;
            padding: 5px 12px;
            font-size: 12px;
            cursor: pointer;
        }

        .content {
            padding: 22px 18px;
        }

        .progress-container {
            height: 6px;
            background: #f0f0f0;
            border-radius: 3px;
            margin-bottom: 22px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: #4b6cb7;
            width: 0%;
        }

        .question-container {
            margin-bottom: 22px;
            text-align: center;
        }

        .question-text {
            font-size: 17px;
            line-height: 1.5;
            color: #222;
            font-weight: bold;
            padding: 0 8px;
            min-height: 60px;
        }

        .question-number {
            display: inline-block;
            width: 26px;
            height: 26px;
            background: #4b6cb7;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 26px;
            font-size: 13px;
            font-weight: bold;
            margin-right: 8px;
        }

        .options {
            margin-top: 12px;
        }

        .option {
            padding: 14px 16px;
            border: 2px solid #e8e8e8;
            border-radius: 12px;
            background: white;
            font-size: 15px;
            line-height: 1.4;
            cursor: pointer;
            text-align: left;
            margin-bottom: 12px;
            min-height: 56px;
        }

        .option.selected {
            border-color: #4b6cb7;
            background-color: #f5faff;
        }

        .option input {
            display: none;
        }

        .option label {
            display: block;
            cursor: pointer;
        }

        .nav-buttons {
            margin-top: 18px;
        }

        .btn {
            display: block;
            width: 100%;
            padding: 13px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 10px;
        }

        .btn-group {
            display: flex;
            gap: 10px;
        }

        .btn-group .btn {
            margin-bottom: 0;
        }

        .prev-btn {
            background: #f0f0f0;
            color: #555;
        }

        .prev-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .next-btn, .submit-btn {
            background: #4b6cb7;
            color: white;
        }

        .next-btn:disabled {
            background: #d0d0d0;
            cursor: not-allowed;
        }

        .result-container {
            display: none;
            padding: 25px 20px;
            text-align: center;
        }

        .result-title {
            font-size: 20px;
            margin-bottom: 16px;
            color: #2c3e50;
        }

        .result-score {
            font-size: 19px;
            margin-bottom: 20px;
            color: #4b6cb7;
            font-weight: bold;
        }

        .result-message h3 {
            color: #4b6cb7;
            margin-bottom: 12px;
            font-size: 17px;
        }

        .result-message p {
            font-size: 15px;
            line-height: 1.6;
            color: #444;
        }

        .final-restart-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 13px;
            border-radius: 10px;
            font-size: 15px;
            font-weight: bold;
            margin-top: 15px;
            cursor: pointer;
            display: block;
            width: 100%;
        }

        .footer {
            text-align: center;
            padding: 16px;
            font-size: 12px;
            color: #888;
            background: #fafafa;
            border-top: 1px solid #eee;
            line-height: 1.5;
        }

        .error-msg {
            display: none;
            padding: 15px;
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            margin: 15px 0;
            color: #856404;
            text-align: center;
            font-size: 14px;
        }

        /* QQ浏览器提示 */
        .qq-hint {
            display: none;
            background: #e3f2fd;
            padding: 12px;
            border-radius: 8px;
            margin: 15px 0;
            font-size: 13px;
            color: #1565c0;
            text-align: center;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <button class="restart-btn" onclick="restartQuiz()">重新答题</button>
        <h1>心理健康自评测试</h1>
        <p>请根据您的实际情况选择最符合的选项</p>
    </div>

    <div class="content" id="quiz-content">
        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>

        <div class="question-container">
            <div class="question-text" id="question-text">加载中...</div>
            <div class="options" id="options-container"></div>
        </div>

        <div class="nav-buttons">
            <div class="btn-group">
                <button class="btn prev-btn" id="prev-btn" onclick="prevQuestion()" disabled>上一题</button>
                <button class="btn next-btn" id="next-btn" onclick="nextQuestion()" disabled>下一题</button>
            </div>
            <button class="btn submit-btn" id="submit-btn" onclick="showResult()" style="display:none;">查看结果</button>
        </div>

        <div class="error-msg" id="error-msg">页面加载失败，请尝试刷新页面</div>
        <div class="qq-hint" id="qq-hint">提示：QQ浏览器可能存在兼容问题，建议使用微信或系统浏览器打开</div>
    </div>

    <div class="result-container" id="result-container">
        <h2 class="result-title">您的评估结果</h2>
        <div class="result-score" id="score-display"></div>
        <div class="result-message" id="result-message"></div>
        <button class="final-restart-btn" onclick="restartQuiz()">重新测试</button>
    </div>

    <div class="footer">
        <p>本测试仅供参考<br>如有需要请咨询专业心理医生</p>
    </div>
</div>

<script>
    // 检测是否为QQ浏览器
    function isQQBrowser() {
        var ua = navigator.userAgent.toLowerCase();
        return ua.indexOf('mqqbrowser') > -1 || ua.indexOf('qq/') > -1;
    }

    // 全部使用 var，避免 let/const
    var questions = [
        {
            question: "在过去两周内，您感到情绪低落、沮丧或绝望的频率如何？",
            options: [
                { text: "几乎每天", score: 3 },
                { text: "超过一半的日子", score: 2 },
                { text: "几天", score: 1 },
                { text: "完全没有", score: 0 }
            ]
        },
        {
            question: "您是否对平时感兴趣的活动失去了兴趣或乐趣？",
            options: [
                { text: "完全失去兴趣", score: 3 },
                { text: "兴趣明显减少", score: 2 },
                { text: "兴趣略有减少", score: 1 },
                { text: "兴趣没有变化", score: 0 }
            ]
        },
        {
            question: "您的睡眠情况如何？",
            options: [
                { text: "几乎每晚都失眠或嗜睡", score: 3 },
                { text: "经常失眠或嗜睡", score: 2 },
                { text: "偶尔失眠或嗜睡", score: 1 },
                { text: "睡眠正常", score: 0 }
            ]
        },
        {
            question: "您是否感到疲劳或精力不足？",
            options: [
                { text: "几乎总是", score: 3 },
                { text: "经常", score: 2 },
                { text: "有时", score: 1 },
                { text: "很少或从不", score: 0 }
            ]
        },
        {
            question: "您是否难以集中注意力、做决定或记忆力下降？",
            options: [
                { text: "非常困难", score: 3 },
                { text: "比较困难", score: 2 },
                { text: "有点困难", score: 1 },
                { text: "没有困难", score: 0 }
            ]
        }
    ];

    var results = [
        { min: 0, max: 4, title: "心理健康状况良好", message: "您的心理健康状况良好，继续保持积极的生活态度和健康的生活方式。" },
        { min: 5, max: 9, title: "轻度情绪困扰", message: "您可能有一些轻微的情绪困扰，建议关注自己的情绪变化，适当放松和调整。" },
        { min: 10, max: 14, title: "中度情绪问题", message: "您可能正在经历中度的情绪问题，建议寻求朋友或家人的支持，必要时考虑专业帮助。" },
        { min: 15, max: 15, title: "严重情绪困扰", message: "您可能正在经历严重的情绪困扰，强烈建议尽快寻求专业心理医生的帮助。" }
    ];

    var currentQuestionIndex = 0;
    var userAnswers = [null, null, null, null, null]; // 明确长度

    function initQuiz() {
        try {
            currentQuestionIndex = 0;
            userAnswers = [null, null, null, null, null];
            document.getElementById('result-container').style.display = 'none';
            document.getElementById('quiz-content').style.display = 'block';
            document.getElementById('error-msg').style.display = 'none';

            // 如果是QQ浏览器，显示提示
            if (isQQBrowser()) {
                document.getElementById('qq-hint').style.display = 'block';
            } else {
                document.getElementById('qq-hint').style.display = 'none';
            }

            updateQuestion();
        } catch (e) {
            showError('初始化失败，请刷新页面');
        }
    }

    function updateQuestion() {
        try {
            var q = questions[currentQuestionIndex];
            if (!q) {
                throw new Error('题目数据异常');
            }

            var questionText = document.getElementById('question-text');
            questionText.innerHTML = '<span class="question-number">' + (currentQuestionIndex + 1) + '</span>' + q.question;

            var progress = (currentQuestionIndex / questions.length) * 100;
            document.getElementById('progress-bar').style.width = progress + '%';

            var container = document.getElementById('options-container');
            container.innerHTML = '';
            for (var i = 0; i < q.options.length; i++) {
                var opt = q.options[i];
                var isSelected = (userAnswers[currentQuestionIndex] === i);
                var div = document.createElement('div');
                div.className = 'option' + (isSelected ? ' selected' : '');
                div.innerHTML = '<input type="radio" name="q' + currentQuestionIndex + '" id="q' + currentQuestionIndex + 'o' + i + '"><label for="q' + currentQuestionIndex + 'o' + i + '">' + opt.text + '</label>';
                div.onclick = (function(idx) {
                    return function() {
                        selectOption(idx);
                    };
                })(i);
                container.appendChild(div);
            }

            document.getElementById('prev-btn').disabled = (currentQuestionIndex === 0);
            var nextBtn = document.getElementById('next-btn');
            var submitBtn = document.getElementById('submit-btn');

            if (currentQuestionIndex === questions.length - 1) {
                nextBtn.style.display = 'none';
                submitBtn.style.display = 'block';
                submitBtn.disabled = (userAnswers[currentQuestionIndex] === null);
            } else {
                nextBtn.style.display = 'block';
                submitBtn.style.display = 'none';
                nextBtn.disabled = (userAnswers[currentQuestionIndex] === null);
            }
        } catch (e) {
            showError('题目加载失败，请刷新重试');
        }
    }

    function selectOption(idx) {
        try {
            userAnswers[currentQuestionIndex] = idx;
            var options = document.getElementsByClassName('option');
            for (var i = 0; i < options.length; i++) {
                if (i === idx) {
                    options[i].className = 'option selected';
                } else {
                    options[i].className = 'option';
                }
            }

            if (currentQuestionIndex === questions.length - 1) {
                document.getElementById('submit-btn').disabled = false;
            } else {
                document.getElementById('next-btn').disabled = false;
            }
        } catch (e) {
            // 忽略错误，不影响使用
        }
    }

    function nextQuestion() {
        if (userAnswers[currentQuestionIndex] !== null) {
            currentQuestionIndex++;
            updateQuestion();
        }
    }

    function prevQuestion() {
        if (currentQuestionIndex > 0) {
            currentQuestionIndex--;
            updateQuestion();
        }
    }

    function showResult() {
        if (userAnswers[currentQuestionIndex] === null) return;

        try {
            var total = 0;
            for (var i = 0; i < userAnswers.length; i++) {
                if (userAnswers[i] !== null) {
                    total += questions[i].options[userAnswers[i]].score;
                }
            }

            document.getElementById('quiz-content').style.display = 'none';
            document.getElementById('result-container').style.display = 'block';
            document.getElementById('score-display').textContent = '您的总分：' + total + ' 分';

            var result = null;
            for (var j = 0; j < results.length; j++) {
                if (total >= results[j].min && total <= results[j].max) {
                    result = results[j];
                    break;
                }
            }

            if (result) {
                document.getElementById('result-message').innerHTML = '<h3>' + result.title + '</h3><p>' + result.message + '</p>';
            }
        } catch (e) {
            showError('结果计算失败，请刷新重试');
        }
    }

    function restartQuiz() {
        initQuiz();
    }

    function showError(msg) {
        var el = document.getElementById('error-msg');
        if (el) {
            el.style.display = 'block';
            el.textContent = msg;
        }
    }

    // 使用 window.onload 确保完全兼容
    window.onload = function() {
        setTimeout(function() {
            try {
                initQuiz();
            } catch (e) {
                showError('页面加载失败，请刷新页面');
            }
        }, 200);
    };
</script>
</body>
</html>
